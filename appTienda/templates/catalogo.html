<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Cat√°logo de Art√≠culos Personalizados</title>
    <style>
        /* Estilos b√°sicos para mejor visualizaci√≥n de filtros y destacados */
        body { font-family: sans-serif; margin: 20px; }
        .filtros-busqueda { margin-bottom: 20px; padding: 15px; border: 1px solid #ccc; border-radius: 5px; background-color: #f9f9f9; }
        .producto-lista { border: 1px solid #eee; padding: 15px; margin-bottom: 10px; border-left: 5px solid #007bff; }
        .destacado { border-left: 5px solid #ffc107; background-color: #fffbe6; }
        .destacado h3::after { content: " (Destacado)"; color: #ffc107; font-size: 0.8em; margin-left: 5px; }
    </style>
</head>
<body>
    <h1>Cat√°logo de Productos</h1>
    
    <div class="filtros-busqueda">
        <h2>Buscar y Filtrar</h2>
        
        <form method="GET" action="{% url 'catalogo' %}" style="margin-bottom: 10px;">
            <input type="text" name="q" placeholder="Buscar por nombre..." value="{{ query|default:'' }}">
            <button type="submit">Buscar</button>
            {% if query %}
                <a href="{% url 'catalogo' %}">Limpiar B√∫squeda</a>
            {% endif %}
        </form>

        <form method="GET" action="{% url 'catalogo' %}">
            <label for="categoria">Filtrar por Categor√≠a:</label>
            <select name="categoria" id="categoria" onchange="this.form.submit()">
                <option value="">Todas las categor√≠as</option>
                {% for categoria in categorias %}
                    <option value="{{ categoria.id }}" {% if categoria.id|stringformat:"i" == categoria_seleccionada %}selected{% endif %}>
                        {{ categoria.nombre }}
                    </option>
                {% endfor %}
            </select>
        </form>

        <form method="GET" action="{% url 'catalogo' %}" style="margin-top: 10px;">
            <button type="submit" name="destacados" value="1">
              Ver solo productos destacados
            </button>

            {% if destacados_activo %}
                <a href="{% url 'catalogo' %}" style="margin-left: 10px;">
                    üîÑ Ver todos los productos
                </a>
            {% endif %}
        </form>

    </div>

    {% if productos %}
        <h2>Productos Encontrados ({{ productos.count }})</h2>
        <ul>
            {% for producto in productos %}
                <li class="producto-lista {% if producto.destacado %}destacado{% endif %}">
                    {% if producto.destacado %}
                        <p style="color: #ffc107; font-weight: bold;">‚≠ê Producto Destacado</p>
                    {% endif %}
                    
                    <h3>{{ producto.nombre }}</h3>
                    <p>Categor√≠a: {{ producto.categoria.nombre }}</p>
                    <p>Precio Base: <strong style="color: green;">${{ producto.precio_base }}</strong></p>

                    {% if producto.imagen %}
                        <img src="{{ producto.imagen.url }}" alt="Imagen de {{ producto.nombre }}" width="150" style="border-radius: 5px;">
                    {% endif %}

                    <br>
                    <a href="{% url 'detalle_producto' producto.id %}" style="display: inline-block; margin-top: 10px; padding: 8px 15px; background-color: #007bff; color: white; text-decoration: none; border-radius: 4px;">
                        Ver Detalle y Solicitar
                    </a>
                </li>
                <hr>
            {% endfor %}
        </ul>
    {% else %}
        <p>No se encontraron productos que coincidan con los criterios de b√∫squeda o filtro.</p>
    {% endif %}

</body>
</html>